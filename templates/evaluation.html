{% extends "base.html" %} {% block title %}√âvaluation des Mod√®les - D√©tection de
Paludisme{% endblock %} {% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %} {% block navigation %}
<nav class="bg-green-600 text-white p-4 shadow-lg" role="navigation">
  <div class="container mx-auto flex flex-wrap justify-between items-center">
    <h1 class="text-2xl font-bold">üß¨ D√©tection de Paludisme</h1>
    <div class="flex items-center space-x-4">
      <span class="text-green-100 hidden sm:inline">
        Bienvenue, <strong>{{ username }}</strong>
      </span>
      <div class="flex space-x-2">
        <a
          href="{{ url_for('index') }}"
          class="bg-green-500 hover:bg-green-400 px-4 py-2 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-white"
        >
          Accueil
        </a>
        <a
          href="{{ url_for('evaluation') }}"
          class="bg-green-700 hover:bg-green-600 px-4 py-2 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-white"
        >
          √âvaluation
        </a>
        <a
          href="{{ url_for('history') }}"
          class="bg-green-500 hover:bg-green-400 px-4 py-2 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-white"
        >
          Historique
        </a>
        <a
          href="{{ url_for('auth.logout') }}"
          class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-white"
        >
          D√©connexion
        </a>
      </div>
    </div>
  </div>
</nav>
{% endblock %} {% block content %}
<div class="container mx-auto p-6">
  <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
    üìä √âvaluation des Mod√®les
  </h2>

  <!-- M√©triques principales -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    {% for metric in metrics %}
    <div
      class="bg-white p-6 rounded-xl shadow-lg border-t-4 {% if metric.best %}border-green-500{% else %}border-blue-500{% endif %} hover:shadow-xl transition duration-300"
    >
      <h3 class="text-lg font-semibold text-gray-700 mb-2">
        {{ metric.name }}
      </h3>
      <p
        class="text-3xl font-bold {% if metric.best %}text-green-600{% else %}text-blue-600{% endif %}"
      >
        {{ metric.value }}
      </p>
      {% if metric.best %}
      <span
        class="inline-block mt-2 px-3 py-1 bg-green-100 text-green-700 text-sm font-semibold rounded-full"
      >
        ‚≠ê Meilleur mod√®le
      </span>
      {% endif %}
    </div>
    {% endfor %}
  </div>

  <!-- Graphiques de comparaison -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Accuracy Comparison -->
    <div
      class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition duration-300"
    >
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
        <span class="text-2xl mr-2">üìà</span>
        Comparaison des Accuracies
      </h3>
      <canvas
        id="accuracyChart"
        aria-label="Graphique de comparaison des accuracies"
      ></canvas>
    </div>

    <!-- Loss Comparison -->
    <div
      class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition duration-300"
    >
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
        <span class="text-2xl mr-2">üìâ</span>
        Comparaison des Losses
      </h3>
      <canvas
        id="lossChart"
        aria-label="Graphique de comparaison des losses"
      ></canvas>
    </div>
  </div>

  <!-- Courbes d'entra√Ænement -->
  <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
    <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
      <span class="text-2xl mr-2">üìä</span>
      Courbes d'Entra√Ænement et Validation
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for model in training_data %}
      <div
        class="border border-gray-200 rounded-lg p-4 hover:border-green-500 transition duration-300"
      >
        <h4 class="text-lg font-semibold mb-3 text-center text-gray-700">
          {{ model.name }}
        </h4>
        <canvas
          id="trainingChart{{ loop.index }}"
          aria-label="Graphique d'entra√Ænement pour {{ model.name }}"
        ></canvas>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Matrice de confusion -->
  <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
      <span class="text-2xl mr-2">üéØ</span>
      Matrice de Confusion - {{ best_model_name }}
    </h3>
    <div class="flex justify-center">
      <img
        src="{{ url_for('serve_model_file', filename='confusion_matrix_best.png') }}"
        alt="Matrice de confusion du meilleur mod√®le"
        class="max-w-full h-auto rounded-lg shadow-md"
        onerror="this.parentElement.innerHTML='<p class=\'text-gray-500\'>Image non disponible</p>'"
      />
    </div>
  </div>

  <!-- M√©triques d√©taill√©es -->
  <div class="bg-white p-6 rounded-xl shadow-lg">
    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
      <span class="text-2xl mr-2">üìã</span>
      M√©triques D√©taill√©es
    </h3>
    <div class="overflow-x-auto">
      <table class="min-w-full table-auto">
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Mod√®le
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Accuracy
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Loss
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Precision
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Recall
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              F1-Score
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% for model in detailed_metrics %}
          <tr
            class="{% if model.best %}bg-green-50 hover:bg-green-100{% else %}hover:bg-gray-50{% endif %} transition duration-200"
          >
            <td
              class="px-6 py-4 whitespace-nowrap font-medium {% if model.best %}text-green-600{% else %}text-gray-900{% endif %}"
            >
              {{ model.name }} {% if model.best %}
              <span class="ml-2 text-yellow-500">‚≠ê</span>
              {% endif %}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-gray-700">
              {{ model.accuracy }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-gray-700">
              {{ model.loss }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-gray-700">
              {{ model.precision }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-gray-700">
              {{ model.recall }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-gray-700">
              {{ model.f1_score }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Donn√©es pour les graphiques
      const modelNames = {{ model_names | tojson }};
      const accuracies = {{ accuracies | tojson }};
      const losses = {{ losses | tojson }};
      const trainingData = {{ training_data | tojson }};

      // Configuration commune pour les graphiques
      const commonOptions = {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
              legend: {
                  display: true,
                  position: 'top'
              }
          }
      };

      // Graphique de comparaison des accuracies
      const accuracyCtx = document.getElementById('accuracyChart').getContext('2d');
      new Chart(accuracyCtx, {
          type: 'bar',
          data: {
              labels: modelNames,
              datasets: [{
                  label: 'Accuracy de Validation',
                  data: accuracies,
                  backgroundColor: [
                      'rgba(54, 162, 235, 0.7)',
                      'rgba(75, 192, 192, 0.7)',
                      'rgba(153, 102, 255, 0.7)'
                  ],
                  borderColor: [
                      'rgba(54, 162, 235, 1)',
                      'rgba(75, 192, 192, 1)',
                      'rgba(153, 102, 255, 1)'
                  ],
                  borderWidth: 2
              }]
          },
          options: {
              ...commonOptions,
              scales: {
                  y: {
                      beginAtZero: true,
                      max: 1.0,
                      ticks: {
                          callback: function(value) {
                              return (value * 100).toFixed(0) + '%';
                          }
                      }
                  }
              }
          }
      });

      // Graphique de comparaison des losses
      const lossCtx = document.getElementById('lossChart').getContext('2d');
      new Chart(lossCtx, {
          type: 'bar',
          data: {
              labels: modelNames,
              datasets: [{
                  label: 'Loss de Validation',
                  data: losses,
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.7)',
                      'rgba(255, 159, 64, 0.7)',
                      'rgba(255, 205, 86, 0.7)'
                  ],
                  borderColor: [
                      'rgba(255, 99, 132, 1)',
                      'rgba(255, 159, 64, 1)',
                      'rgba(255, 205, 86, 1)'
                  ],
                  borderWidth: 2
              }]
          },
          options: {
              ...commonOptions,
              scales: {
                  y: {
                      beginAtZero: true
                  }
              }
          }
      });

      // Courbes d'entra√Ænement pour chaque mod√®le
      trainingData.forEach((model, index) => {
          const ctx = document.getElementById(`trainingChart${index + 1}`).getContext('2d');
          new Chart(ctx, {
              type: 'line',
              data: {
                  labels: Array.from({length: model.epochs}, (_, i) => `Epoch ${i + 1}`),
                  datasets: [
                      {
                          label: 'Train',
                          data: model.train_acc,
                          borderColor: 'rgb(54, 162, 235)',
                          backgroundColor: 'rgba(54, 162, 235, 0.1)',
                          tension: 0.3,
                          fill: true
                      },
                      {
                          label: 'Validation',
                          data: model.val_acc,
                          borderColor: 'rgb(255, 99, 132)',
                          backgroundColor: 'rgba(255, 99, 132, 0.1)',
                          tension: 0.3,
                          fill: true
                      }
                  ]
              },
              options: {
                  responsive: true,
                  maintainAspectRatio: true,
                  plugins: {
                      title: {
                          display: true,
                          text: `${model.name} - Accuracy`,
                          font: {
                              size: 14,
                              weight: 'bold'
                          }
                      },
                      legend: {
                          display: true,
                          position: 'bottom'
                      }
                  },
                  scales: {
                      y: {
                          beginAtZero: true,
                          max: 1.0,
                          ticks: {
                              callback: function(value) {
                                  return (value * 100).toFixed(0) + '%';
                              }
                          }
                      }
                  }
              }
          });
      });
  });
</script>
{% endblock %}
